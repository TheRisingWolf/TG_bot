Архитектура проекта


```
├── app
│   ├── config
│   │   ├── __init__.py
│   │   ├── settings.py
│   ├── __init__.py
│   ├── database.py
│   ├── handlers
│   │   ├── __init__.py
│   │   └── todo_handler.py
│   ├── keyboards
│   │   ├── __init__.py
│   │   └── todo_keyboard.py
│   ├── models.py
│   ├── states.py
│   └── utils.py
├── env
├── requirements.txt
└── app.py
```

* `app/config/__init__.py`: модуль, объединяющий настройки приложения
* `app/config/settings.py`: модуль, содержащий настройки приложения
* `app/__init__.py`: модуль, объединяющий все компоненты приложения
* `app/database.py`: модуль для работы с базой данных
* `app/handlers/__init__.py`: пакет, содержащий все обработчики для приложения
* `app/handlers/todo_handler.py`: модуль, содержащий обработчики команд, связанных с задачами (TODO)
* `app/keyboards/__init__.py`: пакет, содержащий все клавиатуры для приложения
* `app/keyboards/todo_keyboard.py`: модуль, содержащий клавиатуру для списка задач (TODO)
* `states.py`: файл содержит функцию-декоратор для добавления State'ов к классу, а также пример использования этой функции для создания StatesGroup с двумя State'ами.
* `app/models.py`: модуль, содержащий модели для работы с базой данных
* `app/utils.py`: модуль с вспомогательными функциями для приложения
* `env`: каталог с настройками виртуального окружения Python
* `requirements.txt`: файл с зависимостями проекта
* `app.py`: главный файл приложения, в котором создается и запускается экземпляр бота и регистрируются обработчики команд и событий.




# Получение токена
![img.png](readme_images/init_bot_token.png)

# Процесс разработки

* Настройте `config` и `.env`

* Установите библиотеку aiogram с помощью команды `pip install aiogram`. \
Эта библиотека позволяет создавать ботов для Telegram на языке Python.

Создайте файл main.py и импортируйте необходимые модули, такие как aiogram, config, handlers ...

* Создайте нового бота в Telegram, следуя инструкциям на сайте Telegram. Получите токен бота и добавьте его в файл config/settings.py, создав новую переменную BOT_TOKEN.

* Создайте модуль handlers/todo_handler.py, который будет обрабатывать команды для списка задач. Реализуйте методы для обработки команды /start, добавления новой задачи, удаления всех задач и отмены добавления новой задачи.

* Создайте модуль keyboards/todo_keyboard.py, который будет создавать кастомную клавиатуру для управления списком задач.

* Создайте модуль database.py, который будет создавать соединение с базой данных и создавать необходимые таблицы в базе данных.

* Создайте модуль models.py, который будет описывать модели для базы данных, включая модель для задач.

* Создайте модуль utils.py, который будет содержать вспомогательные функции для работы с задачами.

* В модуле main.py создайте экземпляр бота, подключите обработчики из модуля handlers/todo_handler.py и запустите бота.

* Запустите скрипт main.py, чтобы запустить бота и проверить его работоспособность.


# Поэтапный процесс разработки

Сначала подготовьте базу данных (MySql):

`.env`
```dotenv
TOKEN=your_bot_token
DATABASE_URL=mysql://username:password@localhost/db_name
```

1. Создаём структуру проекта:

* Создаём корневую папку проекта
* Создаём папку `app`, в которой будут находиться файлы приложения
* Создаём папку `config` внутри папки `app`, в которой будут находиться файлы конфигурации.
* Создаём пустой файл `__init__.py` внутри папки app и внутри папок `config, handlers, keyboards, states, utils`
* Создаём файл `database.py` внутри папки `app`, где будут находиться функции для работы с базой данных.
* Создаём файл `models.py` внутри папки `app`, где будут находиться модели для базы данных.
* Создаём файл `todo_keyboard.py` внутри папки `app/keyboards`, где будут находиться функции для создания клавиатуры списка задач.
* Создаём файл `states.py` внутри папки `app`, где будут находиться состояния для FSM.
* Создаём файл `todo_handler.py` внутри папки `app/handlers`, где будут находиться функции для обработки команд пользователя.
* Создаём файл `utils.py` внутри папки `app`, где будут находиться настройки приложения.
* Создаём файл `settings.py` внутри папки `config`, где будут находиться настройки приложения.
* Создаём файл `requirements.txt`, где будут указаны зависимости проекта.

2. Настраиваем окружение:

* Создаём виртуальное окружение.
* Активируем виртуальное окружение.
* Устанавливаем зависимости из requirements.txt.

3. Настриваем базу данных:

* Импортируем модуль create_engine из библиотеки sqlalchemy
* Создаём объект engine, используя create_engine и указав путь к базе данных
* Импортируем модуль Base из sqlalchemy.ext.declarative
* Создаём объект Base.metadata, используя Base.metadata.create_all(bind=engine) для создания таблиц в базе данных

4. Настраиваем клавиатуру:
* Импортируем модуль `ReplyKeyboardMarkup` из `aiogram.types`
* Создаём объект `TodoKeyboard` с помощью `ReplyKeyboardMarkup`


5. Настраиваем  FSM:
* Импортируем модуль `FSMContext` из `aiogram.dispatcher`
* Импортируем модуль `state` из `aiogram.dispatcher.filters`
* Импортируем модуль `StatesGroup` из `aiogram.dispatcher.filters.state`
* Создаём класс `TodoHandler`, унаследованный от `StatesGroup`, в котором будут находиться состояния для FSM


6. Настраиваем обработчики команд и callback-ов

7. Реализовываем базовые функции обработки задач в `todo_handler.py`, используя aiogram и sqlalchemy. В файле созданы State’ы, настроен обработчик команды start, добавления и удаления задач, а также отмены добавления новой задачи.


8. Создаём клавиатуру для взаимодействия с задачами в `todo_keyboard.py`. Добавляем кнопки для добавления новой задачи и удаления всех задач.


9. Добавляем модели TodoTask и Base в `models.py`, чтобы можно было создать таблицу задач в базе данных.


10. Пишем утилиту `create_todo_list` в `utils.py` для форматирования списка задач перед выводом в чат.


11. Создаём файл `states.py`, где определяем функцию state_factory для автоматического добавления State’ов к классам-обработчикам.


12. Добавляем файл `settings.py` в папку config для хранения конфигурационных параметров, таких как токен бота и параметры подключения к базе данных.


13. Создаём основной файл приложения `app.py`, который настраивает логгирование, создаёт объекты бота и диспатчера, а также подключается к базе данных. Также добавляем обработчики для запуска бота и обработки ошибок.


14. Запускаем приложение `app.py` и проверяем его работоспособность в телеграмм-чате   





Создание файла с зависимости проекта:

```
pip freeze > requirements.txt 
```


Бот:

![img.png](readme_images/TheRW_bot_1.png)

![img.png](readme_images/TheRW_bot_2.png)

